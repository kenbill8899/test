<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°è‚¡è²·è³£è©¦ç®— - æç›Šè¨ˆç®—å™¨ (æ‰‹æ©Ÿå‹å–„)</title>
    <style>
        /* åŸºç¤ CSS æ¨£å¼ */
        body {
            font-family: Arial, sans-serif;
            margin: 0; /* ç§»é™¤å¤–å±¤é è¨­é‚Šè· */
            background-color: #f5f5f5;
        }
        .container {
            max-width: 450px; 
            margin: 20px auto; /* å±…ä¸­ä¸¦å¢åŠ ä¸Šä¸‹é‚Šè· */
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* æ‰‹æ©ŸéŸ¿æ‡‰å¼è¨­è¨ˆå„ªåŒ– */
        @media (max-width: 600px) {
            .container {
                margin: 0;
                border-radius: 0; /* æ‰‹æ©Ÿä¸Šç§»é™¤åœ“è§’ä»¥å……æ»¿è¢å¹• */
                padding: 15px;
            }
            body {
                padding-top: 20px;
            }
        }
        
        h2 {
            text-align: center;
            color: #d9534f;
        }
        .input-group, .result-group {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 4px;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .input-group input, .input-group select {
            width: calc(100% - 10px);
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            margin-bottom: 5px;
        }
        /* æ•¸é‡è¼¸å…¥å’Œå–®ä½é¸æ“‡çš„æ’ç‰ˆ */
        .input-shares-container {
            display: flex;
            align-items: center;
        }
        .input-shares-container input {
            flex-grow: 1;
            margin-right: 10px;
        }
        .input-shares-container select {
            width: 80px;
            flex-shrink: 0; /* é¿å…å–®ä½è¢«æ“ å£“ */
        }
        button {
            width: 100%;
            padding: 10px;
            background-color: #5cb85c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }
        button:hover {
            background-color: #4cae4c;
        }
        .result-group {
            border: 1px solid #ddd;
            background-color: #f9f9f9;
        }
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px dashed #eee;
        }
        .section-title {
            background-color: #eee;
            padding: 5px;
            margin-top: 10px;
            font-weight: bold;
            text-align: center;
            border-radius: 4px;
        }
        
        /* ====== æç›Šé¡¯ç¤ºæ’ç‰ˆä¿®æ”¹ ====== */
        .profit-highlight {
            font-size: 1.1em;
            padding: 8px 0;
            margin-top: 10px;
            border-top: 2px solid #ddd;
            display: grid; /* ä½¿ç”¨ Grid ä½ˆå±€ */
            grid-template-columns: 1fr 1fr; /* åˆ†æˆå·¦å³å…©æ¬„ */
            font-weight: bold;
            align-items: center;
        }
        .profit-highlight .label-text {
            /* å·¦å´æ–‡å­—ï¼Œè·¨å…©è¡Œ */
            grid-row: span 2; 
            align-self: start;
        }
        .profit-highlight .value {
            text-align: right; /* å³å´æ•¸å€¼é å³å°é½Š */
        }
        .profit-highlight .amount {
            font-size: 1.2em; /* é‡‘é¡å¤§ä¸€é» */
        }
        .profit-highlight .percent {
            font-size: 0.9em; /* ç™¾åˆ†æ¯”å°ä¸€é» */
            margin-top: -5px; /* è®“ç™¾åˆ†æ¯”é è¿‘é‡‘é¡ */
        }
        /* ç´…æ¼²ç¶ è·Œ (å°ç£æ…£ä¾‹ï¼šç´…è³º/æ¼²ï¼Œç¶ è³ /è·Œ) */
        .profit-red { color: #d9534f; } /* ç´…è‰² */
        .profit-green { color: #5cb85c; } /* ç¶ è‰² */
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ“ˆ å°è‚¡è²·è³£æç›Šè©¦ç®—</h2>

    <div class="input-group">
        <label for="discount">é›»å­ä¸‹å–®æŠ˜æ‰£ (ä¾‹å¦‚: 3æŠ˜è«‹è¼¸å…¥ 0.3):</label>
        <input type="number" id="discount" value="0.3" min="0" max="1" step="0.01">
    </div>

    <div class="section-title">è²·å…¥è³‡è¨Š</div>
    <div class="input-group">
        <label for="buyPrice">è²·å…¥åƒ¹ (å…ƒ):</label>
        <input type="number" id="buyPrice" value="64.35" min="0" step="0.01">
        
        <label for="buyQuantity">è²·å…¥æ•¸é‡:</label>
        <div class="input-shares-container">
            <input type="number" id="buyQuantity" value="1" min="0">
            <select id="buyUnit">
                <option value="share">è‚¡</option>
                <option value="lot" selected>å¼µ</option>
            </select>
        </div>
    </div>

    <div class="section-title">è³£å‡ºè³‡è¨Š</div>
    <div class="input-group">
        <label for="sellPrice">è³£å‡ºåƒ¹ (å…ƒ):</label>
        <input type="number" id="sellPrice" value="64.75" min="0" step="0.01">
        
        <label for="sellQuantity">è³£å‡ºæ•¸é‡:</label>
        <div class="input-shares-container">
            <input type="number" id="sellQuantity" value="1" min="0">
            <select id="sellUnit">
                <option value="share">è‚¡</option>
                <option value="lot" selected>å¼µ</option>
            </select>
        </div>
    </div>

    <button onclick="calculateProfitLoss()">è¨ˆç®—æç›Š</button>
    
    <div class="result-group">
        <div class="section-title" style="background-color: #d9edf7; color: #31708f;">äº¤æ˜“è²»ç”¨èˆ‡æ”¶æ”¯</div>

        <div class="result-item"><span>è²·å…¥æ‰‹çºŒè²»:</span> <span id="buyFee">--</span></div>
        <div class="result-item"><span>**ç¸½æ”¯å‡º (è²·å…¥æˆæœ¬):**</span> <span id="totalBuyCost">--</span></div>
        
        <hr>

        <div class="result-item"><span>è³£å‡ºæ‰‹çºŒè²»:</span> <span id="sellFee">--</span></div>
        <div class="result-item"><span>è­‰åˆ¸äº¤æ˜“ç¨… (è³£å‡º):</span> <span id="tax">--</span></div>
        <div class="result-item"><span>**ç¸½æ”¶å…¥ (è³£å‡ºæ·¨é¡):**</span> <span id="totalSellIncome">--</span></div>
        
        <div class="profit-highlight">
            <span class="label-text">æ·¨ç²åˆ©é‡‘é¡<br>æç›Šç‡(%):</span> 
            <span class="value amount" id="netProfitLossAmount">--</span>
            <span class="value percent" id="netProfitLossPercent">--</span>
        </div>
    </div>
</div>

<script>
    // JavaScript æ ¸å¿ƒè¨ˆç®—é‚è¼¯
    function calculateProfitLoss() {
        // 1. ç²å–è¼¸å…¥å€¼
        const discount = parseFloat(document.getElementById('discount').value) || 1;
        const buyPrice = parseFloat(document.getElementById('buyPrice').value) || 0;
        const sellPrice = parseFloat(document.getElementById('sellPrice').value) || 0;
        
        // è™•ç†è‚¡æ•¸ (å¼µæˆ–è‚¡)
        const buyQuantityInput = parseFloat(document.getElementById('buyQuantity').value) || 0;
        const buyUnit = document.getElementById('buyUnit').value;
        const sellQuantityInput = parseFloat(document.getElementById('sellQuantity').value) || 0;
        const sellUnit = document.getElementById('sellUnit').value;

        // è½‰æ›ç‚ºç¸½è‚¡æ•¸ (1å¼µ = 1000è‚¡)
        const buyShares = buyUnit === 'lot' ? buyQuantityInput * 1000 : buyQuantityInput;
        const sellShares = sellUnit === 'lot' ? sellQuantityInput * 1000 : sellQuantityInput;
        
        // 2. å®šç¾©å›ºå®šè²»ç‡ (å°è‚¡)
        const commissionRate = 0.001425; // 0.1425% æ‰‹çºŒè²»ç‡
        const taxRate = 0.003;          // 0.3% è­‰åˆ¸äº¤æ˜“ç¨…ç‡
        const minFee = 1;               // æœ€ä½æ‰‹çºŒè²» 1 å…ƒ

        // æ ¼å¼åŒ–å·¥å…·
        const amountFormatter = new Intl.NumberFormat('zh-TW', { 
            minimumFractionDigits: 2, 
            maximumFractionDigits: 2 
        });
        const percentFormatter = new Intl.NumberFormat('zh-TW', { 
            minimumFractionDigits: 1, 
            maximumFractionDigits: 1 
        });

        // --- è²·å…¥è¨ˆç®— ---
        const buyAmount = buyPrice * buyShares;
        let calculatedBuyFee = Math.ceil(buyAmount * commissionRate * discount); 
        const buyFee = Math.max(calculatedBuyFee, minFee);
        const totalBuyCost = buyAmount + buyFee; // ç¸½æ”¯å‡º = è²·å…¥é‡‘é¡ + è²·å…¥æ‰‹çºŒè²»

        // --- è³£å‡ºè¨ˆç®— ---
        const sellAmount = sellPrice * sellShares;
        let calculatedSellFee = Math.ceil(sellAmount * commissionRate * discount);
        const sellFee = Math.max(calculatedSellFee, minFee);
        const tax = Math.round(sellAmount * taxRate); 
        const totalSellIncome = sellAmount - sellFee - tax; // ç¸½æ”¶å…¥ = è³£å‡ºé‡‘é¡ - è³£å‡ºæ‰‹çºŒè²» - äº¤æ˜“ç¨…

        // --- æç›Šè¨ˆç®— ---
        const netProfitLoss = totalSellIncome - totalBuyCost; // æ·¨æç›Š = ç¸½æ”¶å…¥ - ç¸½æ”¯å‡º

        // ç²åˆ©ç™¾åˆ†æ¯” (ç›¸å°æ–¼ç¸½æ”¯å‡º)
        const profitPercentage = totalBuyCost > 0 ? (netProfitLoss / totalBuyCost) * 100 : 0;

        // 4. é¡¯ç¤ºçµæœ
        
        // ä¸»è¦è²»ç”¨é¡¯ç¤º
        document.getElementById('buyFee').textContent = amountFormatter.format(buyFee);
        document.getElementById('totalBuyCost').textContent = amountFormatter.format(totalBuyCost);
        document.getElementById('sellFee').textContent = amountFormatter.format(sellFee);
        document.getElementById('tax').textContent = amountFormatter.format(tax);
        document.getElementById('totalSellIncome').textContent = amountFormatter.format(totalSellIncome);

        // æ·¨æç›Šé‡‘é¡èˆ‡ç™¾åˆ†æ¯”é¡¯ç¤º
        const amountElement = document.getElementById('netProfitLossAmount');
        const percentElement = document.getElementById('netProfitLossPercent');
        
        amountElement.textContent = amountFormatter.format(netProfitLoss);
        percentElement.textContent = `(${percentFormatter.format(profitPercentage)}%)`;
        
        // æ ¹æ“šæç›Šèª¿æ•´é¡è‰² (ç´…è³º/æ¼²ï¼Œç¶ è³ /è·Œ - ä¾å°ç£æ…£ä¾‹)
        const colorClass = netProfitLoss > 0 ? 'profit-red' : (netProfitLoss < 0 ? 'profit-green' : '');
        
        // æ¸…é™¤èˆŠé¡è‰²ä¸¦å¥—ç”¨æ–°é¡è‰²
        amountElement.classList.remove('profit-red', 'profit-green');
        percentElement.classList.remove('profit-red', 'profit-green');
        
        if (colorClass) {
            amountElement.classList.add(colorClass);
            percentElement.classList.add(colorClass);
        } else {
            amountElement.style.color = 'black'; 
            percentElement.style.color = 'black'; 
        }
    }

    // é é¢è¼‰å…¥å¾Œï¼Œç›£è½è¼¸å…¥æ¬„ä½çš„è®Šå‹•ä¸¦è‡ªå‹•åŸ·è¡Œè¨ˆç®—
    document.querySelectorAll('input, select').forEach(element => {
        element.addEventListener('input', calculateProfitLoss);
    });

    // é é¢è¼‰å…¥å¾Œè‡ªå‹•åŸ·è¡Œä¸€æ¬¡è¨ˆç®— (ä½¿ç”¨é è¨­å€¼)
    document.addEventListener('DOMContentLoaded', calculateProfitLoss);
</script>

</body>
</html>
