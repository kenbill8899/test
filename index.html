<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>金融交易綜合試算器 (現股/期貨/融資)</title>
    <style>
        /* 基礎 CSS 樣式 (與上一個版本相同，略) */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 450px;
            margin: 20px auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px; 
        }
        
        @media (max-width: 600px) {
            .container {
                margin: 0;
                border-radius: 0;
                padding: 15px;
            }
            body {
                padding-top: 20px;
            }
        }

        h2, h3 {
            text-align: center;
            color: #333;
            border-bottom: 2px solid #ddd;
            padding-bottom: 10px;
            margin-top: 30px;
        }

        .input-group {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 4px;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .input-group input, .input-group select {
            width: calc(100% - 10px);
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            margin-bottom: 5px;
        }
        
        .input-shares-container {
            display: flex;
            align-items: center;
        }
        .input-shares-container input {
            flex-grow: 1;
            margin-right: 10px;
        }
        .input-shares-container select {
            width: 80px;
            flex-shrink: 0;
        }
        
        button {
            width: 100%;
            padding: 10px;
            background-color: #5cb85c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }
        button:hover {
            background-color: #4cae4c;
        }

        .result-group {
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            padding: 10px;
            margin-top: 15px;
            border-radius: 4px;
        }
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px dashed #eee;
        }
        .section-title {
            background-color: #eee;
            padding: 5px;
            margin-top: 10px;
            font-weight: bold;
            text-align: center;
            border-radius: 4px;
            color: #333;
        }

        /* 損益顯示排版 */
        .profit-highlight {
            font-size: 1.1em;
            padding: 8px 0;
            margin-top: 10px;
            border-top: 2px solid #ddd;
            display: grid;
            grid-template-columns: 1fr 1fr;
            font-weight: bold;
            align-items: center;
        }
        .profit-highlight .label-text {
            grid-row: span 2;
            align-self: center;
        }
        .profit-highlight .value {
            text-align: right;
        }
        .profit-highlight .amount {
            font-size: 1.2em;
        }
        .profit-highlight .percent {
            font-size: 0.9em;
            margin-top: -5px;
        }
        /* 紅漲綠跌 (台灣慣例：紅賺/漲，綠賠/跌) */
        .profit-red { color: #d9534f; } 
        .profit-green { color: #5cb85c; } 

        /* 維持率/警示樣式 */
        .margin-status {
            font-weight: bold;
            padding: 5px;
            margin-top: 10px;
            border-radius: 4px;
            text-align: center;
        }
        .status-ok { background-color: #d4edda; color: #155724; } /* 綠色背景：安全 */
        .status-warn { background-color: #fff3cd; color: #856404; } /* 黃色背景：警告 */
        .status-danger { background-color: #f8d7da; color: #721c24; } /* 紅色背景：追繳 */

    </style>
</head>
<body>

<div class="container">
    <h2>💰 金融交易綜合試算器</h2>
    
    <h3 style="color: #d9534f; border-color: #d9534f;">📈 區塊一：台股現股買賣試算</h3>

    <div class="input-group">
        <label for="stockDiscount">電子下單折扣 (例如: 3折請輸入 0.3):</label>
        <input type="number" id="stockDiscount" value="0.3" min="0" max="1" step="0.01">

        <label for="stockTaxRate">證交稅率 (一般/當沖):</label>
        <select id="stockTaxRate" onchange="calculateStockProfitLoss()">
            <option value="0.003" selected>一般交易 (0.3%)</option>
            <option value="0.0015">現股當沖 (0.15%)</option>
        </select>
    </div>

    <div class="section-title" style="background-color: #f7e8d9;">買入資訊</div>
    <div class="input-group">
        <label for="buyPrice">買入價 (元):</label>
        <input type="number" id="buyPrice" value="64.35" min="0" step="0.01" oninput="calculateStockProfitLoss()">
        
        <label for="buyQuantity">買入數量:</label>
        <div class="input-shares-container">
            <input type="number" id="buyQuantity" value="1" min="0" oninput="calculateStockProfitLoss()">
            <select id="buyUnit" onchange="calculateStockProfitLoss()">
                <option value="share">股</option>
                <option value="lot" selected>張</option>
            </select>
        </div>
    </div>

    <div class="section-title" style="background-color: #f7e8d9;">賣出資訊</div>
    <div class="input-group">
        <label for="sellPrice">賣出價 (元):</label>
        <input type="number" id="sellPrice" value="64.75" min="0" step="0.01" oninput="calculateStockProfitLoss()">
        
        <label for="sellQuantity">賣出數量:</label>
        <div class="input-shares-container">
            <input type="number" id="sellQuantity" value="1" min="0" oninput="calculateStockProfitLoss()">
            <select id="sellUnit" onchange="calculateStockProfitLoss()">
                <option value="share">股</option>
                <option value="lot" selected>張</option>
            </select>
        </div>
    </div>

    <button onclick="calculateStockProfitLoss()">計算現股損益</button>
    
    <div class="result-group">
        <div class="section-title" style="background-color: #d9edf7; color: #31708f;">現股交易費用與淨損益</div>
        <div class="result-item"><span>買入手續費:</span> <span id="stockBuyFee">--</span></div>
        <div class="result-item"><span>**總支出 (買入成本):**</span> <span id="stockTotalBuyCost">--</span></div>
        <hr>
        <div class="result-item"><span>賣出手續費:</span> <span id="stockSellFee">--</span></div>
        <div class="result-item"><span>證券交易稅:</span> <span id="stockTax">--</span></div>
        <div class="result-item"><span>**總收入 (賣出淨額):**</span> <span id="stockTotalSellIncome">--</span></div>
        
        <div class="profit-highlight">
            <span class="label-text">🎉 淨獲利金額與<br>損益率(%):</span> 
            <span class="value amount" id="stockNetProfitLossAmount">--</span>
            <span class="value percent" id="stockNetProfitLossPercent">--</span>
        </div>
    </div>


    <h3 style="color: #0d832d; border-color: #0d832d;">🚀 區塊二：台指期買賣試算</h3>

    <div class="input-group">
        <label for="futuresType">選擇期貨合約:</label>
        <select id="futuresType" onchange="updateFuturesDefaults(); calculateFuturesProfitLoss()">
            <option value="TX">大台 (TX) - 200元/點</option>
            <option value="MTX" selected>小台 (MTX) - 50元/點</option>
            <option value="MXFF">微台 (MXFF) - 10元/點</option>
        </select>
        <label for="futuresQuantity">交易口數:</label>
        <input type="number" id="futuresQuantity" value="1" min="1" step="1" oninput="calculateFuturesProfitLoss()">
        <label for="futuresFee">單邊手續費 (議價，元):</label>
        <input type="number" id="futuresFee" value="30" min="1" step="1" oninput="calculateFuturesProfitLoss()">
    </div>

    <div class="section-title" style="background-color: #e6f7d9;">指數點位與損益</div>
    <div class="input-group">
        <label for="futuresBuyPoint">買入點位:</label>
        <input type="number" id="futuresBuyPoint" value="21800" min="0" step="1" oninput="calculateFuturesProfitLoss()">
        <label for="futuresSellPoint">賣出點位:</label>
        <input type="number" id="futuresSellPoint" value="21950" min="0" step="1" oninput="calculateFuturesProfitLoss()">
    </div>

    <button onclick="calculateFuturesProfitLoss()">計算期貨損益</button>
    
    <div class="result-group">
        <div class="section-title" style="background-color: #d9edf7; color: #31708f;">期貨費用與淨損益</div>
        <div class="result-item"><span>每點價值 (契約乘數):</span> <span id="futuresMultiplier">--</span></div>
        <div class="result-item"><span>**原始保證金 (IM):**</span> <span id="futuresInitialMargin">--</span></div>
        <div class="result-item"><span>**維持保證金 (MM):**</span> <span id="futuresMaintenanceMargin">--</span></div>
        <hr>
        <div class="result-item"><span>交易點數價差:</span> <span id="futuresPointDifference">--</span></div>
        <div class="result-item"><span>總手續費 + 交易稅:</span> <span id="futuresTotalCost">--</span></div>

        <div class="profit-highlight">
            <span class="label-text">🎉 淨獲利金額:</span> 
            <span class="value amount" id="futuresNetProfitLossAmount">--</span>
            <span class="value percent" id="futuresNetProfitLossPercent">--</span>
        </div>

        <div id="futuresMarginStatus" class="margin-status">--</div>
    </div>


    <h3 style="color: #6a1b9a; border-color: #6a1b9a;">🏦 區塊三：股票融資買賣試算</h3>

    <div class="input-group">
        <label for="marginType">股票類別 (決定融資成數):</label>
        <select id="marginType" onchange="calculateMarginProfitLoss()">
            <option value="listed" selected>上市股票 (融資成數 60%)</option>
            <option value="otc">上櫃股票 (融資成數 50%)</option>
        </select>
        <label for="marginRate">融資年利率 (年化 %):</label>
        <input type="number" id="marginRate" value="6.5" min="0" step="0.1" oninput="calculateMarginProfitLoss()">
        <label for="marginDays">持有天數 (計息天數):</label>
        <input type="number" id="marginDays" value="30" min="1" step="1" oninput="calculateMarginProfitLoss()">
    </div>

    <div class="section-title" style="background-color: #e6d9f7;">交易資訊 (與現股分開輸入)</div>
    <div class="input-group">
        <label for="marginBuyPrice">買入價 (元):</label>
        <input type="number" id="marginBuyPrice" value="60" min="0" step="0.01" oninput="calculateMarginProfitLoss()">
        <label for="marginSellPrice">賣出價 (元，**填寫現行股價**):</label>
        <input type="number" id="marginSellPrice" value="63" min="0" step="0.01" oninput="calculateMarginProfitLoss()">
        <label for="marginQuantity">交易張數:</label>
        <input type="number" id="marginQuantity" value="1" min="1" step="1" oninput="calculateMarginProfitLoss()">
        <label for="marginDiscount">手續費折扣 (例如: 6折 0.6):</label>
        <input type="number" id="marginDiscount" value="0.6" min="0" max="1" step="0.01" oninput="calculateMarginProfitLoss()">
    </div>

    <button onclick="calculateMarginProfitLoss()">計算融資損益與維持率</button>
    
    <div class="result-group">
        <div class="section-title" style="background-color: #d9edf7; color: #31708f;">融資成本與損益</div>
        <div class="result-item"><span>融資金額 (券商借款):</span> <span id="marginLoanAmount">--</span></div>
        <div class="result-item"><span>**總利息支出 (持有天數):**</span> <span id="marginTotalInterest">--</span></div>
        <div class="result-item"><span>**淨損益 (含所有成本):**</span> <span id="marginNetProfitLossAmount">--</span></div>
        
        <div class="profit-highlight">
            <span class="label-text">🎉 淨損益率<br>(相對於自備款%):</span> 
            <span class="value amount" id="marginNetProfitLossRate">--</span>
            <span class="value percent" id="marginNetProfitLossPercent">--</span>
        </div>
        
        <hr>
        <div class="section-title" style="background-color: #f7e8d9;">融資維持率</div>
        <div class="result-item"><span>**目前維持率:**</span> <span id="marginCurrentRate">--</span></div>
        <div id="marginStatus" class="margin-status">--</div>
    </div>
</div>

<script>
    // 數字格式化工具
    const amountFormatter = new Intl.NumberFormat('zh-TW', { 
        minimumFractionDigits: 0, 
        maximumFractionDigits: 2,
        useGrouping: true
    });
    const percentFormatter = new Intl.NumberFormat('zh-TW', { 
        minimumFractionDigits: 1, 
        maximumFractionDigits: 2
    });

    // ==============================================
    // 函數 1: 現股買賣試算 (省略)
    // ==============================================
    function calculateStockProfitLoss() {
        // ... (與上一個版本相同，為節省空間略)
        const discount = parseFloat(document.getElementById('stockDiscount').value) || 1;
        const taxRate = parseFloat(document.getElementById('stockTaxRate').value) || 0.003;
        const buyPrice = parseFloat(document.getElementById('buyPrice').value) || 0;
        const sellPrice = parseFloat(document.getElementById('sellPrice').value) || 0;
        const buyQuantityInput = parseFloat(document.getElementById('buyQuantity').value) || 0;
        const buyUnit = document.getElementById('buyUnit').value;
        const sellQuantityInput = parseFloat(document.getElementById('sellQuantity').value) || 0;
        const sellUnit = document.getElementById('sellUnit').value;

        const buyShares = buyUnit === 'lot' ? buyQuantityInput * 1000 : buyQuantityInput;
        const sellShares = sellUnit === 'lot' ? sellQuantityInput * 1000 : sellQuantityInput;
        
        const commissionRate = 0.001425;
        const minFee = 1;

        const buyAmount = buyPrice * buyShares;
        let calculatedBuyFee = Math.ceil(buyAmount * commissionRate * discount); 
        const buyFee = Math.max(calculatedBuyFee, minFee);
        const totalBuyCost = buyAmount + buyFee;

        const sellAmount = sellPrice * sellShares;
        let calculatedSellFee = Math.ceil(sellAmount * commissionRate * discount);
        const sellFee = Math.max(calculatedSellFee, minFee);
        const tax = Math.round(sellAmount * taxRate); 
        const totalSellIncome = sellAmount - sellFee - tax;

        const netProfitLoss = totalSellIncome - totalBuyCost;
        const profitPercentage = totalBuyCost > 0 ? (netProfitLoss / totalBuyCost) * 100 : 0;

        document.getElementById('stockBuyFee').textContent = amountFormatter.format(buyFee);
        document.getElementById('stockTotalBuyCost').textContent = amountFormatter.format(totalBuyCost);
        document.getElementById('stockSellFee').textContent = amountFormatter.format(sellFee);
        document.getElementById('stockTax').textContent = amountFormatter.format(tax);
        document.getElementById('stockTotalSellIncome').textContent = amountFormatter.format(totalSellIncome);

        const amountElement = document.getElementById('stockNetProfitLossAmount');
        const percentElement = document.getElementById('stockNetProfitLossPercent');
        
        amountElement.textContent = amountFormatter.format(netProfitLoss);
        percentElement.textContent = `(${percentFormatter.format(profitPercentage)}%)`;
        
        const colorClass = netProfitLoss > 0 ? 'profit-red' : (netProfitLoss < 0 ? 'profit-green' : '');
        amountElement.classList.remove('profit-red', 'profit-green');
        percentElement.classList.remove('profit-red', 'profit-green');
        if (colorClass) {
            amountElement.classList.add(colorClass);
            percentElement.classList.add(colorClass);
        } else {
             amountElement.style.color = 'black'; 
             percentElement.style.color = 'black'; 
        }
    }


    // ==============================================
    // 函數 2: 台指期買賣試算 (新增維持保證金和追繳提示)
    // ==============================================

    // 期貨合約常數 (以期交所最新公告為準，這裡使用參考值)
    const FUTURES_CONTRACTS = {
        'TX': { multiplier: 200, IM: 184000, MM: 142000, taxRate: 0.00002 }, // 大台 (IM: 初始保證金, MM: 維持保證金)
        'MTX': { multiplier: 50, IM: 46000, MM: 35500, taxRate: 0.00002 },  // 小台
        'MXFF': { multiplier: 10, IM: 9200, MM: 7100, taxRate: 0.00002 }   // 微台
    };
    
    function updateFuturesDefaults() {
        const type = document.getElementById('futuresType').value;
        const contract = FUTURES_CONTRACTS[type];
        
        // 顯示合約乘數和預估保證金
        document.getElementById('futuresMultiplier').textContent = amountFormatter.format(contract.multiplier) + ' 元/點';
        document.getElementById('futuresInitialMargin').textContent = amountFormatter.format(contract.IM) + ' 元';
        document.getElementById('futuresMaintenanceMargin').textContent = amountFormatter.format(contract.MM) + ' 元'; // 新增 維持保證金
    }

    function calculateFuturesProfitLoss() {
        const type = document.getElementById('futuresType').value;
        const quantity = parseFloat(document.getElementById('futuresQuantity').value) || 0;
        const fee = parseFloat(document.getElementById('futuresFee').value) || 0;
        const buyPoint = parseFloat(document.getElementById('futuresBuyPoint').value) || 0;
        const sellPoint = parseFloat(document.getElementById('futuresSellPoint').value) || 0;

        if (quantity <= 0) return;

        const contract = FUTURES_CONTRACTS[type];
        const multiplier = contract.multiplier;
        const taxRate = contract.taxRate;
        
        // 1. 損益計算
        const pointDifference = sellPoint - buyPoint;
        const grossProfitLoss = pointDifference * multiplier * quantity;

        // 2. 交易成本 (買賣雙邊稅和手續費)
        const buyAmount = buyPoint * multiplier * quantity;
        const sellAmount = sellPoint * multiplier * quantity;
        const totalTax = Math.round(buyAmount * taxRate) + Math.round(sellAmount * taxRate);
        const totalFee = fee * 2 * quantity;
        const totalCost = totalFee + totalTax;

        // 3. 淨損益
        const netProfitLoss = grossProfitLoss - totalCost;

        // 4. 維持率/追繳計算
        const IMTotal = contract.IM * quantity; // 初始投入的總保證金
        // 期貨帳戶餘額 = 初始保證金 + 淨損益 (假設淨損益尚未實現，但已反映在權益數上)
        const accountEquity = IMTotal + grossProfitLoss; 
        const MMTotal = contract.MM * quantity; // 總維持保證金
        
        // 5. 顯示結果
        document.getElementById('futuresPointDifference').textContent = amountFormatter.format(pointDifference) + ' 點';
        document.getElementById('futuresTotalCost').textContent = amountFormatter.format(totalCost);
        
        const amountElement = document.getElementById('futuresNetProfitLossAmount');
        const statusElement = document.getElementById('futuresMarginStatus');
        
        amountElement.textContent = amountFormatter.format(netProfitLoss);
        
        // 期貨維持率提示
        statusElement.classList.remove('status-ok', 'status-warn', 'status-danger');

        if (accountEquity < MMTotal) {
            const shortfall = MMTotal - accountEquity;
            statusElement.textContent = `❌ 風險警告: 權益數 ${amountFormatter.format(accountEquity)} 元，低於維持保證金！需追繳 ${amountFormatter.format(shortfall)} 元。`;
            statusElement.classList.add('status-danger');
        } else if (accountEquity < IMTotal * 1.2) { // 設一個警示線，例如超過維持保證金一點點
            statusElement.textContent = `⚠️ 餘額接近維持保證金，請留意風險。`;
            statusElement.classList.add('status-warn');
        } else {
            statusElement.textContent = `✅ 權益數 ${amountFormatter.format(accountEquity)} 元，保證金充足。`;
            statusElement.classList.add('status-ok');
        }

        // 根據損益調整顏色
        const colorClass = netProfitLoss > 0 ? 'profit-red' : (netProfitLoss < 0 ? 'profit-green' : '');
        amountElement.classList.remove('profit-red', 'profit-green');
        if (colorClass) {
            amountElement.classList.add(colorClass);
        } else {
             amountElement.style.color = 'black'; 
        }
    }


    // ==============================================
    // 函數 3: 股票融資買賣試算 (新增融資維持率)
    // ==============================================
    function calculateMarginProfitLoss() {
        const type = document.getElementById('marginType').value;
        const rateInput = parseFloat(document.getElementById('marginRate').value) || 0;
        const days = parseFloat(document.getElementById('marginDays').value) || 0;
        const buyPrice = parseFloat(document.getElementById('marginBuyPrice').value) || 0;
        const currentPrice = parseFloat(document.getElementById('marginSellPrice').value) || 0; // 賣出價作為現行股價
        const quantity = parseFloat(document.getElementById('marginQuantity').value) || 0;
        const discount = parseFloat(document.getElementById('marginDiscount').value) || 1;

        if (quantity <= 0) return;

        // 1. 定義常數
        const commissionRate = 0.001425; 
        const taxRate = 0.003;          
        const minFee = 20;              
        const sharesPerLot = 1000;
        const annualDays = 365;
        const financingRate = rateInput / 100; 

        // 融資成數 (上市 60%, 上櫃 50%)
        const loanRatio = type === 'listed' ? 0.6 : 0.5;
        const selfCoverageRatio = 1 - loanRatio;
        
        // 2. 資金計算
        const buyAmount = buyPrice * sharesPerLot * quantity;
        const currentAmount = currentPrice * sharesPerLot * quantity; // 股票現值

        const loanAmount = buyAmount * loanRatio; // 融資借款金額

        // 3. 融資維持率計算
        // 維持率 = (股票現值 / 融資金額) * 100%
        const maintenanceRate = (currentAmount / loanAmount) * 100;

        // 4. 交易成本 (假設現價就是平倉賣出價來計算成本和損益)
        
        // a. 利息 (以融資金額計息)
        const totalInterest = loanAmount * financingRate * (days / annualDays);

        // b. 交易費用 (買入以買價計算，賣出以現價/賣價計算)
        const calculatedBuyFee = buyAmount * commissionRate * discount;
        const buyFee = Math.max(calculatedBuyFee, minFee);
        
        const calculatedSellFee = currentAmount * commissionRate * discount;
        const sellFee = Math.max(calculatedSellFee, minFee);
        const tax = Math.round(currentAmount * taxRate); 
        
        const totalCost = buyFee + sellFee + tax + totalInterest;

        // 5. 損益計算
        const grossProfitLoss = currentAmount - buyAmount; // 價差損益
        const netProfitLoss = grossProfitLoss - totalCost; // 淨損益 = 價差 - 總成本
        
        // 融資淨損益率 (相對於自備款)
        const selfCoverageAmount = buyAmount * selfCoverageRatio;
        const actualSelfCoverage = selfCoverageAmount + buyFee; // 實際投入的資金 (自備款 + 買入手續費)
        const profitPercentage = actualSelfCoverage > 0 ? (netProfitLoss / actualSelfCoverage) * 100 : 0;
        
        // 6. 顯示結果
        document.getElementById('marginLoanAmount').textContent = amountFormatter.format(loanAmount);
        document.getElementById('marginTotalInterest').textContent = amountFormatter.format(totalInterest);
        document.getElementById('marginNetProfitLossAmount').textContent = amountFormatter.format(netProfitLoss);
        
        document.getElementById('marginCurrentRate').textContent = percentFormatter.format(maintenanceRate) + '%';
        
        const amountElement = document.getElementById('marginNetProfitLossRate');
        const percentElement = document.getElementById('marginNetProfitLossPercent');
        const statusElement = document.getElementById('marginStatus');

        amountElement.textContent = amountFormatter.format(netProfitLoss); // 淨損益金額
        percentElement.textContent = `(${percentFormatter.format(profitPercentage)}%)`; // 淨損益率

        // 融資維持率提示
        statusElement.classList.remove('status-ok', 'status-warn', 'status-danger');
        let statusText = '';
        
        if (maintenanceRate < 130) {
            statusText = `🚨 **低於 130% 追繳線！** 需在期限內補繳保證金。`;
            statusElement.classList.add('status-danger');
        } else if (maintenanceRate < 166) {
            statusText = `⚠️ 追繳中，維持率介於 130% - 166%，需補繳才能解除追繳。`;
            statusElement.classList.add('status-warn');
        } else {
            statusText = `✅ **安全區** (維持率 ${percentFormatter.format(maintenanceRate)}%)。`;
            statusElement.classList.add('status-ok');
        }
        statusElement.innerHTML = statusText;

        // 根據淨損益調整顏色
        const colorClass = netProfitLoss > 0 ? 'profit-red' : (netProfitLoss < 0 ? 'profit-green' : '');
        amountElement.classList.remove('profit-red', 'profit-green');
        percentElement.classList.remove('profit-red', 'profit-green');
        if (colorClass) {
            amountElement.classList.add(colorClass);
            percentElement.classList.add(colorClass);
        } else {
             amountElement.style.color = 'black'; 
             percentElement.style.color = 'black'; 
        }
    }

    // 頁面載入後，自動執行所有計算
    document.addEventListener('DOMContentLoaded', () => {
        calculateStockProfitLoss();

        // 期貨
        updateFuturesDefaults();
        calculateFuturesProfitLoss();
        document.querySelectorAll('#futuresType, #futuresQuantity, #futuresFee, #futuresBuyPoint, #futuresSellPoint').forEach(element => {
            element.addEventListener('input', calculateFuturesProfitLoss);
        });

        // 融資
        calculateMarginProfitLoss();
        document.querySelectorAll('#marginType, #marginRate, #marginDays, #marginBuyPrice, #marginSellPrice, #marginQuantity, #marginDiscount').forEach(element => {
            element.addEventListener('input', calculateMarginProfitLoss);
        });
    });
</script>

</body>
</html>
