<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>台股買賣試算 - 損益計算器 (手機友善)</title>
    <style>
        /* 基礎 CSS 樣式 */
        body {
            font-family: Arial, sans-serif;
            margin: 0; /* 移除外層預設邊距 */
            background-color: #f5f5f5;
        }
        .container {
            max-width: 450px; 
            margin: 20px auto; /* 居中並增加上下邊距 */
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* 手機響應式設計優化 */
        @media (max-width: 600px) {
            .container {
                margin: 0;
                border-radius: 0; /* 手機上移除圓角以充滿螢幕 */
                padding: 15px;
            }
            body {
                padding-top: 20px;
            }
        }
        
        h2 {
            text-align: center;
            color: #d9534f;
        }
        .input-group, .result-group {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 4px;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .input-group input, .input-group select {
            width: calc(100% - 10px);
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            margin-bottom: 5px;
        }
        /* 數量輸入和單位選擇的排版 */
        .input-shares-container {
            display: flex;
            align-items: center;
        }
        .input-shares-container input {
            flex-grow: 1;
            margin-right: 10px;
        }
        .input-shares-container select {
            width: 80px;
            flex-shrink: 0; /* 避免單位被擠壓 */
        }
        button {
            width: 100%;
            padding: 10px;
            background-color: #5cb85c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }
        button:hover {
            background-color: #4cae4c;
        }
        .result-group {
            border: 1px solid #ddd;
            background-color: #f9f9f9;
        }
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px dashed #eee;
        }
        .section-title {
            background-color: #eee;
            padding: 5px;
            margin-top: 10px;
            font-weight: bold;
            text-align: center;
            border-radius: 4px;
        }
        
        /* ====== 損益顯示排版修改 ====== */
        .profit-highlight {
            font-size: 1.1em;
            padding: 8px 0;
            margin-top: 10px;
            border-top: 2px solid #ddd;
            display: grid; /* 使用 Grid 佈局 */
            grid-template-columns: 1fr 1fr; /* 分成左右兩欄 */
            font-weight: bold;
            align-items: center;
        }
        .profit-highlight .label-text {
            /* 左側文字，跨兩行 */
            grid-row: span 2; 
            align-self: start;
        }
        .profit-highlight .value {
            text-align: right; /* 右側數值靠右對齊 */
        }
        .profit-highlight .amount {
            font-size: 1.2em; /* 金額大一點 */
        }
        .profit-highlight .percent {
            font-size: 0.9em; /* 百分比小一點 */
            margin-top: -5px; /* 讓百分比靠近金額 */
        }
        /* 紅漲綠跌 (台灣慣例：紅賺/漲，綠賠/跌) */
        .profit-red { color: #d9534f; } /* 紅色 */
        .profit-green { color: #5cb85c; } /* 綠色 */
    </style>
</head>
<body>

<div class="container">
    <h2>📈 台股買賣損益試算</h2>

    <div class="input-group">
        <label for="discount">電子下單折扣 (例如: 3折請輸入 0.3):</label>
        <input type="number" id="discount" value="0.3" min="0" max="1" step="0.01">
    </div>

    <div class="section-title">買入資訊</div>
    <div class="input-group">
        <label for="buyPrice">買入價 (元):</label>
        <input type="number" id="buyPrice" value="64.35" min="0" step="0.01">
        
        <label for="buyQuantity">買入數量:</label>
        <div class="input-shares-container">
            <input type="number" id="buyQuantity" value="1" min="0">
            <select id="buyUnit">
                <option value="share">股</option>
                <option value="lot" selected>張</option>
            </select>
        </div>
    </div>

    <div class="section-title">賣出資訊</div>
    <div class="input-group">
        <label for="sellPrice">賣出價 (元):</label>
        <input type="number" id="sellPrice" value="64.75" min="0" step="0.01">
        
        <label for="sellQuantity">賣出數量:</label>
        <div class="input-shares-container">
            <input type="number" id="sellQuantity" value="1" min="0">
            <select id="sellUnit">
                <option value="share">股</option>
                <option value="lot" selected>張</option>
            </select>
        </div>
    </div>

    <button onclick="calculateProfitLoss()">計算損益</button>
    
    <div class="result-group">
        <div class="section-title" style="background-color: #d9edf7; color: #31708f;">交易費用與收支</div>

        <div class="result-item"><span>買入手續費:</span> <span id="buyFee">--</span></div>
        <div class="result-item"><span>**總支出 (買入成本):**</span> <span id="totalBuyCost">--</span></div>
        
        <hr>

        <div class="result-item"><span>賣出手續費:</span> <span id="sellFee">--</span></div>
        <div class="result-item"><span>證券交易稅 (賣出):</span> <span id="tax">--</span></div>
        <div class="result-item"><span>**總收入 (賣出淨額):**</span> <span id="totalSellIncome">--</span></div>
        
        <div class="profit-highlight">
            <span class="label-text">淨獲利金額<br>損益率(%):</span> 
            <span class="value amount" id="netProfitLossAmount">--</span>
            <span class="value percent" id="netProfitLossPercent">--</span>
        </div>
    </div>
</div>

<script>
    // JavaScript 核心計算邏輯
    function calculateProfitLoss() {
        // 1. 獲取輸入值
        const discount = parseFloat(document.getElementById('discount').value) || 1;
        const buyPrice = parseFloat(document.getElementById('buyPrice').value) || 0;
        const sellPrice = parseFloat(document.getElementById('sellPrice').value) || 0;
        
        // 處理股數 (張或股)
        const buyQuantityInput = parseFloat(document.getElementById('buyQuantity').value) || 0;
        const buyUnit = document.getElementById('buyUnit').value;
        const sellQuantityInput = parseFloat(document.getElementById('sellQuantity').value) || 0;
        const sellUnit = document.getElementById('sellUnit').value;

        // 轉換為總股數 (1張 = 1000股)
        const buyShares = buyUnit === 'lot' ? buyQuantityInput * 1000 : buyQuantityInput;
        const sellShares = sellUnit === 'lot' ? sellQuantityInput * 1000 : sellQuantityInput;
        
        // 2. 定義固定費率 (台股)
        const commissionRate = 0.001425; // 0.1425% 手續費率
        const taxRate = 0.003;          // 0.3% 證券交易稅率
        const minFee = 1;               // 最低手續費 1 元

        // 格式化工具
        const amountFormatter = new Intl.NumberFormat('zh-TW', { 
            minimumFractionDigits: 2, 
            maximumFractionDigits: 2 
        });
        const percentFormatter = new Intl.NumberFormat('zh-TW', { 
            minimumFractionDigits: 1, 
            maximumFractionDigits: 1 
        });

        // --- 買入計算 ---
        const buyAmount = buyPrice * buyShares;
        let calculatedBuyFee = Math.ceil(buyAmount * commissionRate * discount); 
        const buyFee = Math.max(calculatedBuyFee, minFee);
        const totalBuyCost = buyAmount + buyFee; // 總支出 = 買入金額 + 買入手續費

        // --- 賣出計算 ---
        const sellAmount = sellPrice * sellShares;
        let calculatedSellFee = Math.ceil(sellAmount * commissionRate * discount);
        const sellFee = Math.max(calculatedSellFee, minFee);
        const tax = Math.round(sellAmount * taxRate); 
        const totalSellIncome = sellAmount - sellFee - tax; // 總收入 = 賣出金額 - 賣出手續費 - 交易稅

        // --- 損益計算 ---
        const netProfitLoss = totalSellIncome - totalBuyCost; // 淨損益 = 總收入 - 總支出

        // 獲利百分比 (相對於總支出)
        const profitPercentage = totalBuyCost > 0 ? (netProfitLoss / totalBuyCost) * 100 : 0;

        // 4. 顯示結果
        
        // 主要費用顯示
        document.getElementById('buyFee').textContent = amountFormatter.format(buyFee);
        document.getElementById('totalBuyCost').textContent = amountFormatter.format(totalBuyCost);
        document.getElementById('sellFee').textContent = amountFormatter.format(sellFee);
        document.getElementById('tax').textContent = amountFormatter.format(tax);
        document.getElementById('totalSellIncome').textContent = amountFormatter.format(totalSellIncome);

        // 淨損益金額與百分比顯示
        const amountElement = document.getElementById('netProfitLossAmount');
        const percentElement = document.getElementById('netProfitLossPercent');
        
        amountElement.textContent = amountFormatter.format(netProfitLoss);
        percentElement.textContent = `(${percentFormatter.format(profitPercentage)}%)`;
        
        // 根據損益調整顏色 (紅賺/漲，綠賠/跌 - 依台灣慣例)
        const colorClass = netProfitLoss > 0 ? 'profit-red' : (netProfitLoss < 0 ? 'profit-green' : '');
        
        // 清除舊顏色並套用新顏色
        amountElement.classList.remove('profit-red', 'profit-green');
        percentElement.classList.remove('profit-red', 'profit-green');
        
        if (colorClass) {
            amountElement.classList.add(colorClass);
            percentElement.classList.add(colorClass);
        } else {
            amountElement.style.color = 'black'; 
            percentElement.style.color = 'black'; 
        }
    }

    // 頁面載入後，監聽輸入欄位的變動並自動執行計算
    document.querySelectorAll('input, select').forEach(element => {
        element.addEventListener('input', calculateProfitLoss);
    });

    // 頁面載入後自動執行一次計算 (使用預設值)
    document.addEventListener('DOMContentLoaded', calculateProfitLoss);
</script>

</body>
</html>
